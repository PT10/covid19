import { Component, OnInit } from '@angular/core';
import { BaseCases } from '../baseCases';
import * as echarts from 'echarts/lib/echarts';

import { worldGeoJson } from '../world-json-provider.service';

@Component({
  selector: 'app-world-active-cases',
  templateUrl: './world-active-cases.component.html',
  styleUrls: ['./world-active-cases.component.css']
})
export class WorldActiveCasesComponent extends BaseCases implements OnInit{

  relocatedCounties;
  selectedDateIndex: number;
  inProgress = false;

  chartTitle = 'Covid 19 daily world active trends';

  constructor() {
    super();
    this.seriesData = [
      {"Country/Region": "Afghanistan", "Province/State": NaN, "actualDelta": 164, "forecastDelta": 66, "actual": 2335, "forecast": 2237}, {"Country/Region": "Albania", "Province/State": NaN, "actualDelta": 9, "forecastDelta": 8, "actual": 782, "forecast": 781}, {"Country/Region": "Algeria", "Province/State": NaN, "actualDelta": 148, "forecastDelta": 108, "actual": 4154, "forecast": 4114}, {"Country/Region": "Andorra", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 745, "forecast": 745}, {"Country/Region": "Angola", "Province/State": NaN, "actualDelta": 3, "forecastDelta": 0, "actual": 30, "forecast": 27}, {"Country/Region": "Antigua and Barbuda", "Province/State": NaN, "actualDelta": 1, "forecastDelta": 0, "actual": 25, "forecast": 24}, {"Country/Region": "Argentina", "Province/State": NaN, "actualDelta": 104, "forecastDelta": 126, "actual": 4532, "forecast": 4554}, {"Country/Region": "Armenia", "Province/State": NaN, "actualDelta": 82, "forecastDelta": 53, "actual": 2148, "forecast": 2119}, {"Country/Region": "Australia", "Province/State": "Australian Capital Territory", "actualDelta": 0, "forecastDelta": 0, "actual": 106, "forecast": 106}, {"Country/Region": "Australia", "Province/State": "New South Wales", "actualDelta": 5, "forecastDelta": 11, "actual": 3030, "forecast": 3036}, {"Country/Region": "Australia", "Province/State": "Northern Territory", "actualDelta": -1, "forecastDelta": 0, "actual": 27, "forecast": 28}, {"Country/Region": "Australia", "Province/State": "Queensland", "actualDelta": 1, "forecastDelta": 1, "actual": 1034, "forecast": 1034}, {"Country/Region": "Australia", "Province/State": "South Australia", "actualDelta": 0, "forecastDelta": 0, "actual": 438, "forecast": 438}, {"Country/Region": "Australia", "Province/State": "Tasmania", "actualDelta": 0, "forecastDelta": 2, "actual": 221, "forecast": 223}, {"Country/Region": "Australia", "Province/State": "Victoria", "actualDelta": 7, "forecastDelta": 1, "actual": 1371, "forecast": 1365}, {"Country/Region": "Australia", "Province/State": "Western Australia", "actualDelta": 0, "forecastDelta": 0, "actual": 551, "forecast": 551}, {"Country/Region": "Austria", "Province/State": NaN, "actualDelta": 79, "forecastDelta": 63, "actual": 15531, "forecast": 15515}, {"Country/Region": "Azerbaijan", "Province/State": NaN, "actualDelta": 50, "forecastDelta": 36, "actual": 1854, "forecast": 1840}, {"Country/Region": "Bahamas", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 81, "forecast": 81}, {"Country/Region": "Bahrain", "Province/State": NaN, "actualDelta": 130, "forecastDelta": 71, "actual": 3170, "forecast": 3111}, {"Country/Region": "Bangladesh", "Province/State": NaN, "actualDelta": 571, "forecastDelta": 304, "actual": 8238, "forecast": 7971}, {"Country/Region": "Barbados", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 81, "forecast": 81}, {"Country/Region": "Belarus", "Province/State": NaN, "actualDelta": 890, "forecastDelta": 432, "actual": 14917, "forecast": 14459}, {"Country/Region": "Belgium", "Province/State": NaN, "actualDelta": 513, "forecastDelta": 666, "actual": 49032, "forecast": 49185}, {"Country/Region": "Benin", "Province/State": NaN, "actualDelta": 26, "forecastDelta": 0, "actual": 90, "forecast": 64}, {"Country/Region": "Bhutan", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 7, "forecast": 7}, {"Country/Region": "Bolivia", "Province/State": NaN, "actualDelta": 119, "forecastDelta": 3, "actual": 1229, "forecast": 1113}, {"Country/Region": "Bosnia and Herzegovina", "Province/State": NaN, "actualDelta": 24, "forecastDelta": 46, "actual": 1781, "forecast": 1803}, {"Country/Region": "Brazil", "Province/State": NaN, "actualDelta": 5015, "forecastDelta": 2464, "actual": 92202, "forecast": 89651}, {"Country/Region": "Brunei", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 138, "forecast": 138}, {"Country/Region": "Bulgaria", "Province/State": NaN, "actualDelta": 49, "forecastDelta": 32, "actual": 1555, "forecast": 1538}, {"Country/Region": "Burkina Faso", "Province/State": NaN, "actualDelta": 4, "forecastDelta": 4, "actual": 649, "forecast": 649}, {"Country/Region": "Cabo Verde", "Province/State": NaN, "actualDelta": 1, "forecastDelta": 0, "actual": 122, "forecast": 121}, {"Country/Region": "Cambodia", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 122, "forecast": 122}, {"Country/Region": "Cameroon", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 1832, "forecast": 1832}, {"Country/Region": "Canada", "Province/State": "Alberta", "actualDelta": 218, "forecastDelta": 158, "actual": 5573, "forecast": 5513}, {"Country/Region": "Canada", "Province/State": "British Columbia", "actualDelta": 33, "forecastDelta": 25, "actual": 2145, "forecast": 2137}, {"Country/Region": "Canada", "Province/State": "Grand Princess", "actualDelta": 0, "forecastDelta": 0, "actual": 13, "forecast": 13}, {"Country/Region": "Canada", "Province/State": "Manitoba", "actualDelta": 4, "forecastDelta": 1, "actual": 281, "forecast": 278}, {"Country/Region": "Canada", "Province/State": "New Brunswick", "actualDelta": 0, "forecastDelta": 0, "actual": 118, "forecast": 118}, {"Country/Region": "Canada", "Province/State": "Newfoundland and Labrador", "actualDelta": 1, "forecastDelta": 0, "actual": 259, "forecast": 258}, {"Country/Region": "Canada", "Province/State": "Nova Scotia", "actualDelta": 12, "forecastDelta": 12, "actual": 959, "forecast": 959}, {"Country/Region": "Canada", "Province/State": "Ontario", "actualDelta": 485, "forecastDelta": 417, "actual": 17880, "forecast": 17812}, {"Country/Region": "Canada", "Province/State": "Prince Edward Island", "actualDelta": 0, "forecastDelta": 0, "actual": 27, "forecast": 27}, {"Country/Region": "Canada", "Province/State": "Quebec", "actualDelta": 1106, "forecastDelta": 815, "actual": 28656, "forecast": 28365}, {"Country/Region": "Canada", "Province/State": "Saskatchewan", "actualDelta": 26, "forecastDelta": 6, "actual": 415, "forecast": 395}, {"Country/Region": "Central African Republic", "Province/State": NaN, "actualDelta": 22, "forecastDelta": 0, "actual": 72, "forecast": 50}, {"Country/Region": "Chad", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 73, "forecast": 73}, {"Country/Region": "Chile", "Province/State": NaN, "actualDelta": 985, "forecastDelta": 448, "actual": 17008, "forecast": 16471}, {"Country/Region": "China", "Province/State": "Anhui", "actualDelta": 0, "forecastDelta": 0, "actual": 991, "forecast": 991}, {"Country/Region": "China", "Province/State": "Beijing", "actualDelta": 0, "forecastDelta": 0, "actual": 593, "forecast": 592}, {"Country/Region": "China", "Province/State": "Chongqing", "actualDelta": 0, "forecastDelta": 0, "actual": 579, "forecast": 579}, {"Country/Region": "China", "Province/State": "Fujian", "actualDelta": 0, "forecastDelta": 0, "actual": 356, "forecast": 356}, {"Country/Region": "China", "Province/State": "Gansu", "actualDelta": 0, "forecastDelta": 0, "actual": 139, "forecast": 139}, {"Country/Region": "China", "Province/State": "Guangdong", "actualDelta": 0, "forecastDelta": 0, "actual": 1588, "forecast": 1588}, {"Country/Region": "China", "Province/State": "Guangxi", "actualDelta": 0, "forecastDelta": 0, "actual": 254, "forecast": 254}, {"Country/Region": "China", "Province/State": "Guizhou", "actualDelta": 0, "forecastDelta": 0, "actual": 147, "forecast": 147}, {"Country/Region": "China", "Province/State": "Hainan", "actualDelta": 0, "forecastDelta": 0, "actual": 168, "forecast": 168}, {"Country/Region": "China", "Province/State": "Hebei", "actualDelta": 0, "forecastDelta": 0, "actual": 328, "forecast": 328}, {"Country/Region": "China", "Province/State": "Heilongjiang", "actualDelta": 0, "forecastDelta": 0, "actual": 944, "forecast": 944}, {"Country/Region": "China", "Province/State": "Henan", "actualDelta": 0, "forecastDelta": 0, "actual": 1276, "forecast": 1276}, {"Country/Region": "China", "Province/State": "Hong Kong", "actualDelta": 2, "forecastDelta": 3, "actual": 1039, "forecast": 1040}, {"Country/Region": "China", "Province/State": "Hubei", "actualDelta": 0, "forecastDelta": 0, "actual": 68128, "forecast": 68128}, {"Country/Region": "China", "Province/State": "Hunan", "actualDelta": 0, "forecastDelta": 0, "actual": 1019, "forecast": 1019}, {"Country/Region": "China", "Province/State": "Inner Mongolia", "actualDelta": 0, "forecastDelta": 0, "actual": 201, "forecast": 201}, {"Country/Region": "China", "Province/State": "Jiangsu", "actualDelta": 0, "forecastDelta": 0, "actual": 653, "forecast": 653}, {"Country/Region": "China", "Province/State": "Jiangxi", "actualDelta": 0, "forecastDelta": 0, "actual": 937, "forecast": 937}, {"Country/Region": "China", "Province/State": "Jilin", "actualDelta": 1, "forecastDelta": 0, "actual": 112, "forecast": 111}, {"Country/Region": "China", "Province/State": "Liaoning", "actualDelta": 0, "forecastDelta": 0, "actual": 146, "forecast": 146}, {"Country/Region": "China", "Province/State": "Macau", "actualDelta": 0, "forecastDelta": 0, "actual": 45, "forecast": 45}, {"Country/Region": "China", "Province/State": "Ningxia", "actualDelta": 0, "forecastDelta": 0, "actual": 75, "forecast": 75}, {"Country/Region": "China", "Province/State": "Qinghai", "actualDelta": 0, "forecastDelta": 0, "actual": 18, "forecast": 18}, {"Country/Region": "China", "Province/State": "Shaanxi", "actualDelta": 0, "forecastDelta": 0, "actual": 306, "forecast": 306}, {"Country/Region": "China", "Province/State": "Shandong", "actualDelta": 0, "forecastDelta": 0, "actual": 787, "forecast": 786}, {"Country/Region": "China", "Province/State": "Shanghai", "actualDelta": 0, "forecastDelta": 1, "actual": 652, "forecast": 653}, {"Country/Region": "China", "Province/State": "Shanxi", "actualDelta": 0, "forecastDelta": 0, "actual": 197, "forecast": 197}, {"Country/Region": "China", "Province/State": "Sichuan", "actualDelta": 0, "forecastDelta": 0, "actual": 561, "forecast": 560}, {"Country/Region": "China", "Province/State": "Tianjin", "actualDelta": 0, "forecastDelta": 0, "actual": 190, "forecast": 190}, {"Country/Region": "China", "Province/State": "Tibet", "actualDelta": 0, "forecastDelta": 0, "actual": 1, "forecast": 1}, {"Country/Region": "China", "Province/State": "Xinjiang", "actualDelta": 0, "forecastDelta": 0, "actual": 76, "forecast": 76}, {"Country/Region": "China", "Province/State": "Yunnan", "actualDelta": 0, "forecastDelta": 0, "actual": 185, "forecast": 185}, {"Country/Region": "China", "Province/State": "Zhejiang", "actualDelta": 0, "forecastDelta": 0, "actual": 1268, "forecast": 1268}, {"Country/Region": "Colombia", "Province/State": NaN, "actualDelta": 499, "forecastDelta": 206, "actual": 7006, "forecast": 6713}, {"Country/Region": "Congo (Brazzaville)", "Province/State": NaN, "actualDelta": 9, "forecastDelta": 0, "actual": 229, "forecast": 220}, {"Country/Region": "Congo (Kinshasa)", "Province/State": NaN, "actualDelta": 32, "forecastDelta": 17, "actual": 604, "forecast": 589}, {"Country/Region": "Costa Rica", "Province/State": NaN, "actualDelta": 6, "forecastDelta": 5, "actual": 725, "forecast": 724}, {"Country/Region": "Cote d'Ivoire", "Province/State": NaN, "actualDelta": 58, "forecastDelta": 30, "actual": 1333, "forecast": 1305}, {"Country/Region": "Croatia", "Province/State": NaN, "actualDelta": 9, "forecastDelta": 14, "actual": 2085, "forecast": 2090}, {"Country/Region": "Diamond Princess", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 712, "forecast": 712}, {"Country/Region": "Cuba", "Province/State": NaN, "actualDelta": 36, "forecastDelta": 33, "actual": 1537, "forecast": 1534}, {"Country/Region": "Cyprus", "Province/State": NaN, "actualDelta": 7, "forecastDelta": 7, "actual": 857, "forecast": 857}, {"Country/Region": "Czechia", "Province/State": NaN, "actualDelta": 55, "forecastDelta": 119, "actual": 7737, "forecast": 7801}, {"Country/Region": "Denmark", "Province/State": "Faroe Islands", "actualDelta": 0, "forecastDelta": 0, "actual": 187, "forecast": 187}, {"Country/Region": "Denmark", "Province/State": "Greenland", "actualDelta": 0, "forecastDelta": 0, "actual": 11, "forecast": 11}, {"Country/Region": "Denmark", "Province/State": NaN, "actualDelta": 153, "forecastDelta": 150, "actual": 9311, "forecast": 9308}, {"Country/Region": "Djibouti", "Province/State": NaN, "actualDelta": 8, "forecastDelta": 9, "actual": 1097, "forecast": 1098}, {"Country/Region": "Dominican Republic", "Province/State": NaN, "actualDelta": 316, "forecastDelta": 201, "actual": 7288, "forecast": 7173}, {"Country/Region": "Ecuador", "Province/State": NaN, "actualDelta": 1402, "forecastDelta": 198, "actual": 26336, "forecast": 25132}, {"Country/Region": "Egypt", "Province/State": NaN, "actualDelta": 358, "forecastDelta": 166, "actual": 5895, "forecast": 5703}, {"Country/Region": "El Salvador", "Province/State": NaN, "actualDelta": 29, "forecastDelta": 12, "actual": 424, "forecast": 407}, {"Country/Region": "Equatorial Guinea", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 315, "forecast": 315}, {"Country/Region": "Eritrea", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 39, "forecast": 39}, {"Country/Region": "Estonia", "Province/State": NaN, "actualDelta": 5, "forecastDelta": 27, "actual": 1694, "forecast": 1716}, {"Country/Region": "Eswatini", "Province/State": NaN, "actualDelta": 6, "forecastDelta": 0, "actual": 106, "forecast": 100}, {"Country/Region": "Ethiopia", "Province/State": NaN, "actualDelta": 2, "forecastDelta": 1, "actual": 133, "forecast": 132}, {"Country/Region": "Fiji", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 18, "forecast": 18}, {"Country/Region": "Finland", "Province/State": NaN, "actualDelta": 56, "forecastDelta": 89, "actual": 5051, "forecast": 5084}, {"Country/Region": "France", "Province/State": "French Guiana", "actualDelta": 2, "forecastDelta": 0, "actual": 128, "forecast": 126}, {"Country/Region": "France", "Province/State": "French Polynesia", "actualDelta": 0, "forecastDelta": 0, "actual": 58, "forecast": 58}, {"Country/Region": "France", "Province/State": "Guadeloupe", "actualDelta": 1, "forecastDelta": 0, "actual": 152, "forecast": 151}, {"Country/Region": "France", "Province/State": "Mayotte", "actualDelta": 0, "forecastDelta": 10, "actual": 539, "forecast": 549}, {"Country/Region": "France", "Province/State": "New Caledonia", "actualDelta": 0, "forecastDelta": 0, "actual": 18, "forecast": 18}, {"Country/Region": "France", "Province/State": "Reunion", "actualDelta": 2, "forecastDelta": 0, "actual": 422, "forecast": 420}, {"Country/Region": "France", "Province/State": "Saint Barthelemy", "actualDelta": 0, "forecastDelta": 0, "actual": 6, "forecast": 6}, {"Country/Region": "France", "Province/State": "St Martin", "actualDelta": 0, "forecastDelta": 0, "actual": 38, "forecast": 38}, {"Country/Region": "France", "Province/State": "Martinique", "actualDelta": 1, "forecastDelta": 2, "actual": 179, "forecast": 180}, {"Country/Region": "France", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 1706, "actual": 165764, "forecast": 167470}, {"Country/Region": "Gabon", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 276, "forecast": 276}, {"Country/Region": "Gambia", "Province/State": NaN, "actualDelta": 1, "forecastDelta": 0, "actual": 12, "forecast": 11}, {"Country/Region": "Georgia", "Province/State": NaN, "actualDelta": 27, "forecastDelta": 13, "actual": 566, "forecast": 552}, {"Country/Region": "Germany", "Province/State": NaN, "actualDelta": 1068, "forecastDelta": 1439, "actual": 164077, "forecast": 164448}, {"Country/Region": "Ghana", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 2074, "forecast": 2074}, {"Country/Region": "Greece", "Province/State": NaN, "actualDelta": 21, "forecastDelta": 18, "actual": 2612, "forecast": 2609}, {"Country/Region": "Guatemala", "Province/State": NaN, "actualDelta": 45, "forecastDelta": 20, "actual": 644, "forecast": 619}, {"Country/Region": "Guinea", "Province/State": NaN, "actualDelta": 42, "forecastDelta": 41, "actual": 1537, "forecast": 1536}, {"Country/Region": "Guyana", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 82, "forecast": 82}, {"Country/Region": "Haiti", "Province/State": NaN, "actualDelta": 4, "forecastDelta": 0, "actual": 85, "forecast": 81}, {"Country/Region": "Holy See", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 11, "forecast": 11}, {"Country/Region": "Honduras", "Province/State": NaN, "actualDelta": 33, "forecastDelta": 15, "actual": 804, "forecast": 786}, {"Country/Region": "Hungary", "Province/State": NaN, "actualDelta": 88, "forecastDelta": 47, "actual": 2863, "forecast": 2822}, {"Country/Region": "Iceland", "Province/State": NaN, "actualDelta": 1, "forecastDelta": 1, "actual": 1798, "forecast": 1798}, {"Country/Region": "India", "Province/State": NaN, "actualDelta": 2394, "forecastDelta": 1256, "actual": 37257, "forecast": 36119}, {"Country/Region": "Indonesia", "Province/State": NaN, "actualDelta": 433, "forecastDelta": 315, "actual": 10551, "forecast": 10433}, {"Country/Region": "Iran", "Province/State": NaN, "actualDelta": 1006, "forecastDelta": 1032, "actual": 95646, "forecast": 95672}, {"Country/Region": "Iraq", "Province/State": NaN, "actualDelta": 68, "forecastDelta": 50, "actual": 2153, "forecast": 2135}, {"Country/Region": "Ireland", "Province/State": NaN, "actualDelta": 221, "forecastDelta": 353, "actual": 20833, "forecast": 20965}, {"Country/Region": "Israel", "Province/State": NaN, "actualDelta": 155, "forecastDelta": 118, "actual": 16101, "forecast": 16064}, {"Country/Region": "Italy", "Province/State": NaN, "actualDelta": 1965, "forecastDelta": 2526, "actual": 207428, "forecast": 207989}, {"Country/Region": "Jamaica", "Province/State": NaN, "actualDelta": 10, "forecastDelta": 4, "actual": 432, "forecast": 426}, {"Country/Region": "Japan", "Province/State": NaN, "actualDelta": 217, "forecastDelta": 191, "actual": 14305, "forecast": 14279}, {"Country/Region": "Jordan", "Province/State": NaN, "actualDelta": 6, "forecastDelta": 1, "actual": 459, "forecast": 454}, {"Country/Region": "Kazakhstan", "Province/State": NaN, "actualDelta": 195, "forecastDelta": 111, "actual": 3597, "forecast": 3513}, {"Country/Region": "Kenya", "Province/State": NaN, "actualDelta": 15, "forecastDelta": 11, "actual": 411, "forecast": 407}, {"Country/Region": "Korea, South", "Province/State": NaN, "actualDelta": 6, "forecastDelta": 9, "actual": 10780, "forecast": 10783}, {"Country/Region": "Kuwait", "Province/State": NaN, "actualDelta": 353, "forecastDelta": 129, "actual": 4377, "forecast": 4153}, {"Country/Region": "Kyrgyzstan", "Province/State": NaN, "actualDelta": 10, "forecastDelta": 14, "actual": 756, "forecast": 760}, {"Country/Region": "Latvia", "Province/State": NaN, "actualDelta": 12, "forecastDelta": 8, "actual": 870, "forecast": 866}, {"Country/Region": "Lebanon", "Province/State": NaN, "actualDelta": 4, "forecastDelta": 5, "actual": 729, "forecast": 730}, {"Country/Region": "Liberia", "Province/State": NaN, "actualDelta": 11, "forecastDelta": 0, "actual": 152, "forecast": 141}, {"Country/Region": "Liechtenstein", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 82, "forecast": 82}, {"Country/Region": "Lithuania", "Province/State": NaN, "actualDelta": 14, "forecastDelta": 9, "actual": 1399, "forecast": 1394}, {"Country/Region": "Luxembourg", "Province/State": NaN, "actualDelta": 18, "forecastDelta": 15, "actual": 3802, "forecast": 3799}, {"Country/Region": "Madagascar", "Province/State": NaN, "actualDelta": 4, "forecastDelta": 0, "actual": 132, "forecast": 128}, {"Country/Region": "Malaysia", "Province/State": NaN, "actualDelta": 69, "forecastDelta": 72, "actual": 6071, "forecast": 6074}, {"Country/Region": "Maldives", "Province/State": NaN, "actualDelta": 23, "forecastDelta": 9, "actual": 491, "forecast": 477}, {"Country/Region": "Malta", "Province/State": NaN, "actualDelta": 2, "forecastDelta": 3, "actual": 467, "forecast": 468}, {"Country/Region": "Mauritania", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 8, "forecast": 8}, {"Country/Region": "Mauritius", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 332, "forecast": 332}, {"Country/Region": "Mexico", "Province/State": NaN, "actualDelta": 1515, "forecastDelta": 565, "actual": 20739, "forecast": 19789}, {"Country/Region": "Moldova", "Province/State": NaN, "actualDelta": 83, "forecastDelta": 113, "actual": 3980, "forecast": 4010}, {"Country/Region": "Monaco", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 95, "forecast": 95}, {"Country/Region": "Mongolia", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 38, "forecast": 38}, {"Country/Region": "Montenegro", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 322, "forecast": 322}, {"Country/Region": "Morocco", "Province/State": NaN, "actualDelta": 146, "forecastDelta": 102, "actual": 4569, "forecast": 4525}, {"Country/Region": "Namibia", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 16, "forecast": 16}, {"Country/Region": "Nepal", "Province/State": NaN, "actualDelta": 2, "forecastDelta": 0, "actual": 59, "forecast": 57}, {"Country/Region": "Netherlands", "Province/State": "Aruba", "actualDelta": 0, "forecastDelta": 0, "actual": 100, "forecast": 100}, {"Country/Region": "Netherlands", "Province/State": "Curacao", "actualDelta": 0, "forecastDelta": 0, "actual": 16, "forecast": 16}, {"Country/Region": "Netherlands", "Province/State": "Sint Maarten", "actualDelta": 1, "forecastDelta": 0, "actual": 76, "forecast": 75}, {"Country/Region": "Netherlands", "Province/State": NaN, "actualDelta": 475, "forecastDelta": 565, "actual": 39791, "forecast": 39881}, {"Country/Region": "New Zealand", "Province/State": NaN, "actualDelta": 6, "forecastDelta": 4, "actual": 1485, "forecast": 1483}, {"Country/Region": "Nicaragua", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 14, "forecast": 14}, {"Country/Region": "Niger", "Province/State": NaN, "actualDelta": 9, "forecastDelta": 5, "actual": 728, "forecast": 724}, {"Country/Region": "Nigeria", "Province/State": NaN, "actualDelta": 238, "forecastDelta": 41, "actual": 2170, "forecast": 1973}, {"Country/Region": "North Macedonia", "Province/State": NaN, "actualDelta": 29, "forecastDelta": 23, "actual": 1494, "forecast": 1488}, {"Country/Region": "Norway", "Province/State": NaN, "actualDelta": 45, "forecastDelta": 48, "actual": 7783, "forecast": 7786}, {"Country/Region": "Oman", "Province/State": NaN, "actualDelta": 99, "forecastDelta": 74, "actual": 2447, "forecast": 2422}, {"Country/Region": "Pakistan", "Province/State": NaN, "actualDelta": 1297, "forecastDelta": 515, "actual": 18114, "forecast": 17332}, {"Country/Region": "Panama", "Province/State": NaN, "actualDelta": 188, "forecastDelta": 148, "actual": 6720, "forecast": 6680}, {"Country/Region": "Papua New Guinea", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 8, "forecast": 8}, {"Country/Region": "Paraguay", "Province/State": NaN, "actualDelta": 67, "forecastDelta": 1, "actual": 333, "forecast": 267}, {"Country/Region": "Peru", "Province/State": NaN, "actualDelta": 3483, "forecastDelta": 1075, "actual": 40459, "forecast": 38051}, {"Country/Region": "Philippines", "Province/State": NaN, "actualDelta": 284, "forecastDelta": 216, "actual": 8772, "forecast": 8704}, {"Country/Region": "Poland", "Province/State": NaN, "actualDelta": 228, "forecastDelta": 237, "actual": 13105, "forecast": 13114}, {"Country/Region": "Portugal", "Province/State": NaN, "actualDelta": 306, "forecastDelta": 561, "actual": 25351, "forecast": 25606}, {"Country/Region": "Qatar", "Province/State": NaN, "actualDelta": 687, "forecastDelta": 472, "actual": 14096, "forecast": 13881}, {"Country/Region": "Romania", "Province/State": NaN, "actualDelta": 327, "forecastDelta": 275, "actual": 12567, "forecast": 12515}, {"Country/Region": "Russia", "Province/State": NaN, "actualDelta": 7933, "forecastDelta": 4307, "actual": 114431, "forecast": 110805}, {"Country/Region": "Rwanda", "Province/State": NaN, "actualDelta": 6, "forecastDelta": 5, "actual": 249, "forecast": 248}, {"Country/Region": "Saint Lucia", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 17, "forecast": 17}, {"Country/Region": "Saint Vincent and the Grenadines", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 16, "forecast": 16}, {"Country/Region": "San Marino", "Province/State": NaN, "actualDelta": 11, "forecastDelta": 14, "actual": 580, "forecast": 583}, {"Country/Region": "Saudi Arabia", "Province/State": NaN, "actualDelta": 1344, "forecastDelta": 952, "actual": 24097, "forecast": 23705}, {"Country/Region": "Senegal", "Province/State": NaN, "actualDelta": 91, "forecastDelta": 17, "actual": 1024, "forecast": 950}, {"Country/Region": "Serbia", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 268, "actual": 9009, "forecast": 9277}, {"Country/Region": "Seychelles", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 11, "forecast": 11}, {"Country/Region": "Singapore", "Province/State": NaN, "actualDelta": 932, "forecastDelta": 528, "actual": 17101, "forecast": 16697}, {"Country/Region": "Slovakia", "Province/State": NaN, "actualDelta": 7, "forecastDelta": 15, "actual": 1403, "forecast": 1411}, {"Country/Region": "Slovenia", "Province/State": NaN, "actualDelta": 5, "forecastDelta": 11, "actual": 1434, "forecast": 1440}, {"Country/Region": "Somalia", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 601, "forecast": 601}, {"Country/Region": "South Africa", "Province/State": NaN, "actualDelta": 304, "forecastDelta": 165, "actual": 5951, "forecast": 5812}, {"Country/Region": "Spain", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 2381, "actual": 213435, "forecast": 215816}, {"Country/Region": "Sri Lanka", "Province/State": NaN, "actualDelta": 27, "forecastDelta": 14, "actual": 690, "forecast": 677}, {"Country/Region": "Sudan", "Province/State": NaN, "actualDelta": 91, "forecastDelta": 0, "actual": 533, "forecast": 442}, {"Country/Region": "Suriname", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 10, "forecast": 10}, {"Country/Region": "Sweden", "Province/State": NaN, "actualDelta": 428, "forecastDelta": 597, "actual": 21520, "forecast": 21689}, {"Country/Region": "Switzerland", "Province/State": NaN, "actualDelta": 119, "forecastDelta": 179, "actual": 29705, "forecast": 29765}, {"Country/Region": "Taiwan*", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 1, "actual": 429, "forecast": 430}, {"Country/Region": "Tanzania", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 480, "forecast": 480}, {"Country/Region": "Thailand", "Province/State": NaN, "actualDelta": 6, "forecastDelta": 11, "actual": 2960, "forecast": 2965}, {"Country/Region": "Togo", "Province/State": NaN, "actualDelta": 7, "forecastDelta": 1, "actual": 123, "forecast": 117}, {"Country/Region": "Trinidad and Tobago", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 116, "forecast": 116}, {"Country/Region": "Tunisia", "Province/State": NaN, "actualDelta": 4, "forecastDelta": 16, "actual": 998, "forecast": 1010}, {"Country/Region": "Turkey", "Province/State": NaN, "actualDelta": 2188, "forecastDelta": 2627, "actual": 122392, "forecast": 122831}, {"Country/Region": "Uganda", "Province/State": NaN, "actualDelta": 2, "forecastDelta": 0, "actual": 85, "forecast": 83}, {"Country/Region": "Ukraine", "Province/State": NaN, "actualDelta": 455, "forecastDelta": 393, "actual": 10861, "forecast": 10799}, {"Country/Region": "United Arab Emirates", "Province/State": NaN, "actualDelta": 557, "forecastDelta": 460, "actual": 13038, "forecast": 12941}, {"Country/Region": "United Kingdom", "Province/State": "Bermuda", "actualDelta": 0, "forecastDelta": 0, "actual": 114, "forecast": 114}, {"Country/Region": "United Kingdom", "Province/State": "Cayman Islands", "actualDelta": 1, "forecastDelta": 0, "actual": 74, "forecast": 73}, {"Country/Region": "United Kingdom", "Province/State": "Channel Islands", "actualDelta": 1, "forecastDelta": 1, "actual": 538, "forecast": 538}, {"Country/Region": "United Kingdom", "Province/State": "Gibraltar", "actualDelta": 0, "forecastDelta": 2, "actual": 144, "forecast": 146}, {"Country/Region": "United Kingdom", "Province/State": "Isle of Man", "actualDelta": 1, "forecastDelta": 1, "actual": 316, "forecast": 316}, {"Country/Region": "United Kingdom", "Province/State": "Montserrat", "actualDelta": 0, "forecastDelta": 0, "actual": 11, "forecast": 11}, {"Country/Region": "United Kingdom", "Province/State": NaN, "actualDelta": 6201, "forecastDelta": 4723, "actual": 177454, "forecast": 175976}, {"Country/Region": "Uruguay", "Province/State": NaN, "actualDelta": 5, "forecastDelta": 13, "actual": 648, "forecast": 656}, {"Country/Region": "US", "Province/State": NaN, "actualDelta": 34037, "forecastDelta": 29566, "actual": 1103461, "forecast": 1098990}, {"Country/Region": "Uzbekistan", "Province/State": NaN, "actualDelta": 47, "forecastDelta": 37, "actual": 2086, "forecast": 2076}, {"Country/Region": "Venezuela", "Province/State": NaN, "actualDelta": 2, "forecastDelta": 1, "actual": 335, "forecast": 334}, {"Country/Region": "Vietnam", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 270, "forecast": 269}, {"Country/Region": "Zambia", "Province/State": NaN, "actualDelta": 3, "forecastDelta": 2, "actual": 109, "forecast": 108}, {"Country/Region": "Zimbabwe", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 40, "forecast": 40}, {"Country/Region": "Canada", "Province/State": "Diamond Princess", "actualDelta": 1, "forecastDelta": 0, "actual": 1, "forecast": 0}, {"Country/Region": "Dominica", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 16, "forecast": 16}, {"Country/Region": "Grenada", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 20, "forecast": 20}, {"Country/Region": "Mozambique", "Province/State": NaN, "actualDelta": 3, "forecastDelta": 0, "actual": 79, "forecast": 76}, {"Country/Region": "Syria", "Province/State": NaN, "actualDelta": 1, "forecastDelta": 0, "actual": 44, "forecast": 43}, {"Country/Region": "Timor-Leste", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 24, "forecast": 24}, {"Country/Region": "Belize", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 18, "forecast": 18}, {"Country/Region": "Canada", "Province/State": "Recovered", "actualDelta": 0, "forecastDelta": 0, "actual": 0, "forecast": 0}, {"Country/Region": "Laos", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 19, "forecast": 19}, {"Country/Region": "Libya", "Province/State": NaN, "actualDelta": 2, "forecastDelta": 0, "actual": 63, "forecast": 61}, {"Country/Region": "West Bank and Gaza", "Province/State": NaN, "actualDelta": 9, "forecastDelta": 0, "actual": 353, "forecast": 344}, {"Country/Region": "Guinea-Bissau", "Province/State": NaN, "actualDelta": 52, "forecastDelta": 0, "actual": 257, "forecast": 205}, {"Country/Region": "Mali", "Province/State": NaN, "actualDelta": 18, "forecastDelta": 10, "actual": 508, "forecast": 500}, {"Country/Region": "Saint Kitts and Nevis", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 15, "forecast": 15}, {"Country/Region": "Canada", "Province/State": "Northwest Territories", "actualDelta": 0, "forecastDelta": 0, "actual": 5, "forecast": 5}, {"Country/Region": "Canada", "Province/State": "Yukon", "actualDelta": 0, "forecastDelta": 0, "actual": 11, "forecast": 11}, {"Country/Region": "Kosovo", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 6, "actual": 806, "forecast": 812}, {"Country/Region": "Burma", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 151, "forecast": 151}, {"Country/Region": "United Kingdom", "Province/State": "Anguilla", "actualDelta": 0, "forecastDelta": 0, "actual": 3, "forecast": 3}, {"Country/Region": "United Kingdom", "Province/State": "British Virgin Islands", "actualDelta": 0, "forecastDelta": 0, "actual": 6, "forecast": 6}, {"Country/Region": "United Kingdom", "Province/State": "Turks and Caicos Islands", "actualDelta": 0, "forecastDelta": 0, "actual": 12, "forecast": 12}, {"Country/Region": "MS Zaandam", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 9, "forecast": 9}, {"Country/Region": "Botswana", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 23, "forecast": 23}, {"Country/Region": "Burundi", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 11, "forecast": 11}, {"Country/Region": "Sierra Leone", "Province/State": NaN, "actualDelta": 12, "forecastDelta": 0, "actual": 136, "forecast": 124}, {"Country/Region": "Netherlands", "Province/State": "Bonaire, Sint Eustatius and Saba", "actualDelta": 1, "forecastDelta": 0, "actual": 6, "forecast": 5}, {"Country/Region": "Malawi", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 37, "forecast": 37}, {"Country/Region": "United Kingdom", "Province/State": "Falkland Islands (Malvinas)", "actualDelta": 0, "forecastDelta": 0, "actual": 13, "forecast": 13}, {"Country/Region": "France", "Province/State": "Saint Pierre and Miquelon", "actualDelta": 0, "forecastDelta": 0, "actual": 1, "forecast": 1}, {"Country/Region": "South Sudan", "Province/State": NaN, "actualDelta": 10, "forecastDelta": 0, "actual": 45, "forecast": 35}, {"Country/Region": "Western Sahara", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 6, "forecast": 6}, {"Country/Region": "Sao Tome and Principe", "Province/State": NaN, "actualDelta": 2, "forecastDelta": 0, "actual": 16, "forecast": 14}, {"Country/Region": "Yemen", "Province/State": NaN, "actualDelta": 1, "forecastDelta": 0, "actual": 7, "forecast": 6}, {"Country/Region": "Comoros", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 1, "forecast": 1}, {"Country/Region": "Tajikistan", "Province/State": NaN, "actualDelta": 0, "forecastDelta": 0, "actual": 15, "forecast": 15}]
  }

  ngOnInit() {
    super.ngOnInit();
    //this.chartHeight = window.document.body.offsetHeight - 100 + 'px';
    echarts.registerMap('world', worldGeoJson); //, this.relocatedCounties
    this.getData();
  }

  getData() {
    this.inProgress = true;
    let actualDeltas = [];

    // Aggregate state wise to country level if any
    const tempSeriesData = [];
    this.seriesData.forEach(data => {
      const series = tempSeriesData.find(s => {
        return s['Country/Region'] === data['Country/Region'] && data['Province/State'] !== NaN
      });
      if (series) {
        series.actualDelta += data.actualDelta;
        series.forecastDelta += data.forecastDelta;
        series.actual += data.actual;
        series.forecast += data.forecast;
      } else {
        tempSeriesData.push(data);
      }
    });
    this.seriesData = tempSeriesData;
    
    this.seriesData.forEach(data => {
      actualDeltas.push(data.actualDelta - data.forecastDelta);
    });

    actualDeltas = actualDeltas.sort((a, b) => {return b - a});
    this.maxVal = actualDeltas[0];
    this.minVal = actualDeltas[actualDeltas.length - 1];
    
    this.processedSeriesData = this.seriesData.map(data => {
      let val;
      if (data.actualDelta === 0 ) {
        val = this.minVal;
      } /*else if (data.forecastDelta === 0) {
        val = 100;
      } */else {
        // val = (data.actualDelta - data.forecastDelta) / data.forecastDelta * 100;
        val = data.actualDelta - data.forecastDelta
      }
      return {name: data['Country/Region'], value: val}
    });

    this.inProgress = false;
  }

  setChartOptions() {
    const me = this;
    this.chartOption.series = [{
          name: 'County covid19 trends',
          type: 'map',
          roam: true,
          map: 'world',
          scaleLimit: {min: 1},
          itemStyle: {
            emphasis: {
              label: {
                show: false
              },
              areaColor: undefined
            }
          },
          data: this.processedSeriesData
        }
      ]
    
    this.chartOption.tooltip = {
        trigger: 'item',
        formatter: function(params) {
          const countyObj = me.seriesData.find(d => {
            return d['Country/Region'] === params['name']
          });

          if (countyObj) {
            return countyObj['Country/Region'] +
            '<br/>' + 'New Cases: ' + countyObj.actualDelta + ' (Forecasted: ' + countyObj.forecastDelta + ')' +
            '<br/>' + 'Total Cases: ' + countyObj.actual + ' (Forecasted: ' + countyObj.forecast + ')'
          }
          return params['name'];
      }}
  }

}